# 2_haplo_summary

Usage: python 2_haplo_summary.py [full path to 'batch_#.haplotypes.tsv'] [path to a directory to create the output dir in]

Example:

`python 2_haplo_summary.py Volumes/populations_r80/batch_1.haplotypes.tsv Volumes/populations_r80/Output`

This script does a lot of summarizing, and uses the batch_#.haplotypes.tsv output from the 
populations module of Stacks as input. An output directory called 'Summary_Output_A'
or 'Summary_Output_B' is created in a user selected directory and several output files
are created here. The naming of output directory will depend on the user choice below.
First a decision will need to be made concerning loci that contain at least one sample with
more than two haplotypes (indicating "polyploidy", sequencing error, or possibly paralogy).
Those individuals can 1) be re-coded as missing data (-), or 2) the whole locus can be removed.
In some cases, it may be a single sample with this condition, in other loci it may be
a majority of samples. Removing entire loci could drop the number by a substantial amount,
whereas coding as missing could substantially drive up the missing data level for the locus.
You can run the summary both ways, as two different directories will be made, and compare.
My practical experience indicates these potentially paralogous loci should be completely
eliminated, and a conservative approach should be taken. 

The following steps will be completed:

  1. Number of loci counted. [function: loci_number]

  2. Number of loci with no variation ("consensus") are counted and moved to a separate file 'batch_#.identical_haplotypes.tsv'. [function: identical_loci]

  3. Number of loci with too many haplotypes per individual (>2) are identified, counted, and moved to a separate file 'batch_#.poly_haplotypes.tsv'. [function: poly_haplos]

  4. The number of SNP sites in each locus is counted and a tab-delimited output file is created with "Sites" and "Catalog_ID" headers, called 'Variable_Sites_Freq_Distribution.txt'. This can be visualized to examine the frequency of lengths of variable sites across loci. [function: haplo_length]

  5. For each individual, the level of missing data is assessed across all loci.  This information is written to a tab-delimited text file, 'Missing_Data_per_Sample.txt', with the headers "Sample", "Loci_With_Missing_Data", and "Perc_Missing_Data". This is useful for identifying low quality samples that may be removed. [function: missing_data]

  6. For each locus, each SNP site is examined to determine if it is biallelic or not. If a site is identified, the locus and SNP site (starting from position '0') are recorded in the main log file. These loci are excluded from the final output. This could be refined to avoid a particular SNP site within a locus in the future. [function: biallelic]

  7. For analysis (a), the loci flagged in steps 2, 3, and 6 are tabulated and excluded from the following steps. For (b), the loci flagged in steps 2 and 6 only are tabulated and excluded from the following steps. The flagged loci are recorded in output file 'Loci_Excluded.txt'. [function: list_gathering] or [function: list_gathering_variation]

  8. Main output 1: A new tsv file is generated by selecting the FIRST SNP site within a locus if the locus has more than one SNP site. This only includes loci passing filters above. Output is written as 'batch_1.singleFirstSNP_haplotypes.tsv' and matches format of original 'batch~.haplotypes.tsv' input file. For (b) polyhaplotypes are coded as missing data, rather than a SNP site, and an output file "Polyhaplotypes_to_Missing_FirstSNP.txt" is made which tells how many samples were re-coded as missing data for each locus as a result. [function: output_tsv] or [function: output_tsv_variation]

  9. Main output 2: A new tsv file is generated by selecting a RANDOM SNP site within a locus if the locus has more than one SNP site. This only includes loci passing filters above. Output is written as 'batch_1.singleRandomSNP_haplotypes.tsv' and matches format of original 'batch~.haplotypes.tsv' input file. The random SNP site chosen is recorded in an output file called 'Random_SNPs.txt' so the sites can actually be tracked back to original input tsv file, if desired. This file has information for all loci, even if there is only one SNP site, and in this case the position will always be [0]. For (b) polyhaplotypes are coded  as missing data, rather than a SNP site, , and an output file  "Polyhaplotypes_to_Missing_FirstSNP.txt" is made which tells how many samples were re-coded as missing data for each locus as a result. [function: output_tsv2] or [function: output_tsv2_variation]

A log file is written with much of the information printed to terminal window, called 
'Summary.log'.


Written for Python 2.7.3

External Dependencies: Numpy (Numerical Python)

# Dan Portik

daniel.portik@uta.edu

February 2016



If you decide to use these scripts or modify the code for your purposes, please cite:

*Portik, D.M., Leaché, A.D., Rivera, D., Blackburn, D.C., Rödel, M.-O., Barej, M.F., 
Hirschfeld, M., Burger, M., and M.K. Fujita. Evaluating mechanisms of diversification 
in a Guineo-Congolian forest frog using demographic model selection. 
In Review, Molecular Ecology.*
